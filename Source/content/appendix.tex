\appendix
\section{Appendix}
\label{sec:appendix}

\begin{lstlisting}[caption=Abstract file storage strategy, label=code:strategyinterface]
class AbstractFileStorageStrategy {
	constructor() {
		if (new.target === AbstractFileStorageStrategy) {
			throw new TypeError("Cannot construct AbstractFileStorageStrategy instances directly.");
		}
	}
	
	create() {
		throw new TypeError("create method has to be implemented.");
	}
	
	getFiles() {
		throw new TypeError("getFiles method has to be implemented.");
	}
	
	deleteFile() {
		throw new TypeError("deleteFile method has to be implemented.");
	}
	
	generateSignedUrl() {
		throw new TypeError("generateSignedUrl method has to be implemented.");
	}
	
	createDirectory() {
		throw new TypeError("createDirectory method has to be implemented.");
	}
	
	deleteDirectory() {
		throw new TypeError("deleteDirectory method has to be implemented.");
	}
}

module.exports = AbstractFileStorageStrategy;
\end{lstlisting}

\begin{lstlisting}[caption=Registrieren des FileStorage Services, label=code:filestorageindex]
	module.exports = function () {
		const app = this;
		
		// Registriert die drei Services
		app.use('/fileStorage/directories', new DirectoryService());
		app.use('/fileStorage/signedUrl', new SignedUrlService());
		app.use('/fileStorage', new FileStorageService());
		
		// Holt die registrierten Services, um die Hooks zu initialisieren
		const fileStorageService = app.service('/fileStorage');
		const signedUrlService = app.service('/fileStorage/signedUrl');
		const directoryService = app.service('/fileStorage/directories');
		
		// Initialisiere "Before"-Hooks
		fileStorageService.before(hooks.before);
		signedUrlService.before(hooks.before);
		directoryService.before(hooks.before);
		
		// Initialisiere "After"-Hooks
		fileStorageService.after(hooks.after);
		signedUrlService.after(hooks.after);
		directoryService.after(hooks.after);
	};
\end{lstlisting}


\begin{lstlisting}[caption=deleteFile() Funktion der AWS S3-Strategy, label=code:awsS3deletefile]
	deleteFile(userId, path) {
		if (!userId || !path) return Promise.reject(new errors.BadRequest('Missing parameters'));
	
		// prüfe Berechtigung für die Löschen-Aktion
		return filePermissionHelper.checkPermissions(userId, path, ['can-write'])
	
			// finde gegeben Nutzer in Datenbank
			.then(res => UserModel.findById(userId).exec())
				.then(result => {
					if (!result || !result.schoolId) return Promise.reject(errors.NotFound("User not found"));
		
					// erstelle AWS-Verbindungsobjekts
					const awsObject = createAWSObject(result.schoolId);
		
					// stelle Parameter für das Löschen der Datei ein
					const params = {
						Bucket: awsObject.bucket,
						Delete: {
							Objects: [
								{
									Key: path
								}
							],
							Quiet: true
						}
					};
		
					// Führe Aktion aus
					return promisify(awsObject.s3.deleteObjects, awsObject.s3)(params);
		});
	}
\end{lstlisting}


\clearpage